<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Impostor Palabras | Tablero</title>
<link rel="stylesheet" href="style.css">
<script src="/socket.io/socket.io.js"></script>
</head>
<body>

<div class="container">

<h1>SALA <span id="room"></span></h1>

<div class="card">
<button onclick="startRound()">Iniciar Partida</button>
<button onclick="startVoting()">VotaciÃ³n</button>
</div>

<div class="card">
<div class="phase" id="phase"></div>
</div>

<div class="card">
<h3>Jugadores</h3>
<div id="players"></div>
</div>

<div class="card">
<h3>Faltan por votar</h3>
<div id="missing"></div>
</div>

<div class="card">
<h3>Conteo de votos</h3>
<div id="voteCounts"></div>
</div>

</div>

<script>
const socket=io();
let room="";

socket.emit("create");

socket.on("room",r=>{
 room=r;
 document.getElementById("room").innerText=r;
});

socket.on("players",list=>{
 document.getElementById("players").innerHTML =
 list.map(p=>`
   <div>
     ${p.name}
     ${p.alive ? "" : "<span class='badge dead'>expulsado</span>"}
   </div>
 `).join("");
});

socket.on("phase",p=>{
 document.getElementById("phase").innerText="Fase: "+p;
});

socket.on("missingVotes",names=>{
 document.getElementById("missing").innerText =
 names.length ? names.join(", ") : "Nadie";
});

socket.on("voteCounts",counts=>{
 document.getElementById("voteCounts").innerHTML =
   Object.entries(counts)
     .map(([name,count])=>`${name}: ${count}`)
     .join("<br>");
});

socket.on("result",r=>{
 if(r.tie){
   alert("Empate â€” nadie expulsado ðŸ¤");
   return;
 }
 alert(`${r.name} ${r.wasImpostor?"ERA":"NO ERA"} el impostor`);
});

socket.on("victory",v=>{
 alert(v==="civiles" ? "Ganaron los civiles ðŸŽ‰" : "GanÃ³ el impostor ðŸ˜ˆ");
});

function startRound(){ socket.emit("startRound",room); }
function startVoting(){ socket.emit("startVoting",room); }
</script>

</body>
</html>
